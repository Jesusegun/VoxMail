<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Settings - AI Email Digest</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8fafc;
            color: #1f2937;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #1a365d 0%, #2563eb 100%);
            color: white;
            padding: 24px;
            text-align: center;
        }
        .content {
            padding: 24px;
        }
        .section {
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid #e5e7eb;
        }
        .section:last-child {
            border-bottom: none;
        }
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #374151;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        .form-checkbox {
            margin-right: 8px;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .help-text {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin-right: 12px;
        }
        .btn-primary {
            background-color: #059669;
            color: white;
        }
        .btn-primary:hover {
            background-color: #047857;
        }
        .btn-secondary {
            background-color: #6b7280;
            color: white;
        }
        .btn-secondary:hover {
            background-color: #4b5563;
        }
        .current-settings {
            background-color: #f0f7ff;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 24px;
        }
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }
        @media (max-width: 768px) {
            .content { padding: 16px; }
            .settings-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öôÔ∏è User Settings</h1>
            <p>Customize your AI email digest experience</p>
        </div>

        <div class="content">
            <div class="current-settings">
                <strong>Current Settings for:</strong> {{ user.email }}<br>
                <span class="help-text">User ID: {{ user_id }}</span>
            </div>

            <form method="POST" action="/update_settings/{{ user_id }}">
                <div class="settings-grid">
                    <!-- Digest Timing Settings -->
                    <div class="section">
                        <div class="section-title">üìÖ Digest Scheduling</div>
                        
                        <div class="form-group">
                            <label for="digest_time" class="form-label">Digest Time (24-hour format)</label>
                            <select id="digest_time" name="digest_time" class="form-select">
                                {% for hour in range(24) %}
                                <option value="{{ hour }}" {% if user.digest_time == hour %}selected{% endif %}>
                                    {{ '%02d:00'|format(hour) }} ({{ '12:00 AM' if hour == 0 else '12:00 PM' if hour == 12 else '%d:00 AM'|format(hour) if hour < 12 else '%d:00 PM'|format(hour-12) }})
                                </option>
                                {% endfor %}
                            </select>
                            <div class="help-text">Choose any hour from 0-23 for your daily digest</div>
                        </div>

                        <div class="form-group">
                            <label for="timezone" class="form-label">Timezone</label>
                            <select id="timezone" name="timezone" class="form-select">
                                <option value="UTC" {% if user.timezone == 'UTC' %}selected{% endif %}>UTC (Coordinated Universal Time)</option>
                                
                                <optgroup label="üåç Africa">
                                    <option value="Africa/Lagos" {% if user.timezone == 'Africa/Lagos' %}selected{% endif %}>Nigeria (WAT, UTC+1)</option>
                                    <option value="Africa/Accra" {% if user.timezone == 'Africa/Accra' %}selected{% endif %}>Ghana (GMT, UTC+0)</option>
                                    <option value="Africa/Cairo" {% if user.timezone == 'Africa/Cairo' %}selected{% endif %}>Egypt (EET, UTC+2)</option>
                                    <option value="Africa/Johannesburg" {% if user.timezone == 'Africa/Johannesburg' %}selected{% endif %}>South Africa (SAST, UTC+2)</option>
                                    <option value="Africa/Nairobi" {% if user.timezone == 'Africa/Nairobi' %}selected{% endif %}>Kenya (EAT, UTC+3)</option>
                                    <option value="Africa/Casablanca" {% if user.timezone == 'Africa/Casablanca' %}selected{% endif %}>Morocco (WET, UTC+1)</option>
                                </optgroup>
                                
                                <optgroup label="üá∫üá∏ North America">
                                    <option value="US/Eastern" {% if user.timezone == 'US/Eastern' %}selected{% endif %}>US Eastern (EST/EDT, UTC-5/-4)</option>
                                    <option value="US/Central" {% if user.timezone == 'US/Central' %}selected{% endif %}>US Central (CST/CDT, UTC-6/-5)</option>
                                    <option value="US/Mountain" {% if user.timezone == 'US/Mountain' %}selected{% endif %}>US Mountain (MST/MDT, UTC-7/-6)</option>
                                    <option value="US/Pacific" {% if user.timezone == 'US/Pacific' %}selected{% endif %}>US Pacific (PST/PDT, UTC-8/-7)</option>
                                    <option value="America/Toronto" {% if user.timezone == 'America/Toronto' %}selected{% endif %}>Canada - Toronto (EST/EDT, UTC-5/-4)</option>
                                </optgroup>
                                
                                <optgroup label="üá™üá∫ Europe">
                                    <option value="Europe/London" {% if user.timezone == 'Europe/London' %}selected{% endif %}>UK - London (GMT/BST, UTC+0/+1)</option>
                                    <option value="Europe/Berlin" {% if user.timezone == 'Europe/Berlin' %}selected{% endif %}>Germany - Berlin (CET/CEST, UTC+1/+2)</option>
                                    <option value="Europe/Paris" {% if user.timezone == 'Europe/Paris' %}selected{% endif %}>France - Paris (CET/CEST, UTC+1/+2)</option>
                                    <option value="Europe/Amsterdam" {% if user.timezone == 'Europe/Amsterdam' %}selected{% endif %}>Netherlands - Amsterdam (CET/CEST, UTC+1/+2)</option>
                                </optgroup>
                                
                                <optgroup label="üåè Asia & Oceania">
                                    <option value="Asia/Tokyo" {% if user.timezone == 'Asia/Tokyo' %}selected{% endif %}>Japan - Tokyo (JST, UTC+9)</option>
                                    <option value="Asia/Shanghai" {% if user.timezone == 'Asia/Shanghai' %}selected{% endif %}>China - Shanghai (CST, UTC+8)</option>
                                    <option value="Asia/Dubai" {% if user.timezone == 'Asia/Dubai' %}selected{% endif %}>UAE - Dubai (GST, UTC+4)</option>
                                    <option value="Asia/Kolkata" {% if user.timezone == 'Asia/Kolkata' %}selected{% endif %}>India - Mumbai/Delhi (IST, UTC+5:30)</option>
                                    <option value="Australia/Sydney" {% if user.timezone == 'Australia/Sydney' %}selected{% endif %}>Australia - Sydney (AEST/AEDT, UTC+10/+11)</option>
                                </optgroup>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="weekend_digests" class="form-label">Weekend Digests</label>
                            <select id="weekend_digests" name="weekend_digests" class="form-select">
                                <option value="full" {% if user.weekend_digests == 'full' %}selected{% endif %}>Full digests on weekends</option>
                                <option value="urgent_only" {% if user.weekend_digests == 'urgent_only' %}selected{% endif %}>Urgent emails only</option>
                                <option value="off" {% if user.weekend_digests == 'off' %}selected{% endif %}>No weekend digests</option>
                            </select>
                        </div>
                    </div>

                    <!-- AI Behavior Settings -->
                    <div class="section">
                        <div class="section-title">ü§ñ AI Display Preferences</div>
                        
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="show_insights_by_default" name="show_insights_by_default" 
                                       class="form-checkbox" {% if user.show_insights_by_default %}checked{% endif %}>
                                <label for="show_insights_by_default" class="form-label">Show AI insights expanded by default</label>
                            </div>
                            <div class="help-text">Whether to show detailed AI analysis without clicking "More Info"</div>
                        </div>
                        
                        <div style="background-color: #f0f7ff; padding: 12px; border-radius: 6px; font-size: 14px;">
                            <strong>üß† Your AI is Smart:</strong> The AI automatically determines priority and displays the right level of detail based on context. No manual tuning needed!
                        </div>
                    </div>
                </div>

                <!-- Vacation Mode -->
                <div class="section">
                    <div class="section-title">üèñÔ∏è Vacation Mode</div>
                    
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="vacation_mode" name="vacation_mode" 
                                   class="form-checkbox" {% if user.vacation_mode %}checked{% endif %}>
                            <label for="vacation_mode" class="form-label">Enable vacation mode</label>
                        </div>
                        <div class="help-text">Pause digests or forward urgent emails to a delegate</div>
                    </div>

                    <div class="form-group">
                        <label for="vacation_delegate" class="form-label">Vacation Delegate Email (optional)</label>
                        <input type="email" id="vacation_delegate" name="vacation_delegate" 
                               class="form-input" value="{{ user.vacation_delegate or '' }}"
                               placeholder="colleague@company.com">
                        <div class="help-text">Urgent emails will be forwarded to this address during vacation</div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div style="margin-top: 32px;">
                    <button type="submit" class="btn btn-primary">üíæ Save Settings</button>
                    <a href="/" class="btn btn-secondary">‚Ü©Ô∏è Back to Dashboard</a>
                </div>
            </form>

            <!-- Current Status -->
            <div class="section" style="margin-top: 32px; border-top: 1px solid #e5e7eb; padding-top: 24px;">
                <div class="section-title">üìä Current Status</div>
                <div class="current-settings">
                    <strong>Next digest:</strong> Tomorrow at {{ '%02d:00'|format(user.digest_time) }} {{ user.timezone }}<br>
                    <strong>Vacation mode:</strong> {{ 'ON' if user.vacation_mode else 'OFF' }}<br>
                    <strong>Account created:</strong> {{ user.created_at[:10] if user.created_at else 'Unknown' }}
                </div>
                
                <div style="margin-top: 16px;">
                    <a href="/generate_digest/{{ user_id }}" class="btn btn-secondary">üß™ Test Digest Generation</a>
                    <a href="/send_digest/{{ user_id }}" class="btn btn-secondary">üìß Send Test Digest</a>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
